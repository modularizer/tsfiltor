<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tsfiltor Playground</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/monokai.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            max-height: calc(100vh - 40px);
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            display: grid;
            grid-template-columns: 2fr 4px 1fr;
            grid-template-rows: 1fr;
            gap: 0;
            min-height: 400px;
            max-height: calc(100vh - 200px);
            height: calc(100vh - 200px);
            position: relative;
            overflow: hidden;
        }

        @media (max-width: 968px) {
            body {
                padding: 10px;
            }
            
            .container {
                max-height: calc(100vh - 20px);
            }
            
            .content {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr 4px 1fr;
                height: calc(100vh - 200px);
                max-height: calc(100vh - 200px);
                min-height: 400px;
            }
            
            .editor-panel, .output-panel {
                max-height: 40vh;
            }
            
            .editor-container {
                max-height: 40vh;
            }
            
            .output-container {
                max-height: 40vh;
            }
            
            .resizer {
                display: block;
                width: 100%;
                height: 4px;
                cursor: row-resize;
            }
            .resizer:hover {
                background: #667eea;
            }
        }

        @media (max-width: 640px) {
            body {
                padding: 0;
            }
            
            .container {
                border-radius: 0;
                max-height: 100vh;
                max-width: 100%;
            }
            
            .header {
                padding: 15px 20px;
            }
            
            .header h1 {
                font-size: 24px;
            }
            
            .content {
                height: calc(100vh - 150px);
                max-height: calc(100vh - 150px);
                min-height: 300px;
            }
        }

        .resizer {
            width: 4px;
            background: #e0e0e0;
            cursor: col-resize;
            position: relative;
            z-index: 10;
            transition: background 0.2s;
        }

        .resizer:hover {
            background: #667eea;
        }

        .resizer.active {
            background: #667eea;
        }

        .editor-panel, .output-panel {
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .panel-header {
            background: #f5f5f5;
            padding: 6px 12px;
            border-bottom: 1px solid #e0e0e0;
            font-weight: 600;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            font-size: 13px;
        }

        .panel-header-title {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .panel-header-controls {
            display: flex;
            align-items: center;
            gap: 10px;
            flex: 1;
            justify-content: flex-end;
        }

        .panel-header-title::before {
            content: '';
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4caf50;
        }

        .output-panel .panel-header-title::before {
            background: #2196f3;
        }

        .editor-container {
            flex: 1;
            position: relative;
            overflow: hidden;
            min-height: 0;
            display: flex;
            flex-direction: column;
        }

        .editor-container .CodeMirror {
            flex: 1;
            height: 100% !important;
        }

        #codeEditor {
            width: 100%;
            height: 100%;
            font-size: 14px;
        }

        .CodeMirror {
            height: 100% !important;
            width: 100% !important;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .CodeMirror-scroll {
            height: 100% !important;
        }

        .CodeMirror-wrap {
            height: 100% !important;
        }

        .CodeMirror-sizer {
            min-height: 100% !important;
        }

        .output-container {
            flex: 1;
            padding: 20px;
            background: #1e1e1e;
            color: #d4d4d4;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            overflow-y: auto;
            overflow-x: auto;
            white-space: pre-wrap;
            word-wrap: break-word;
            min-height: 0;
        }

        .output-container.error {
            color: #f48771;
        }

        .output-container.success {
            color: #4ec9b0;
        }


        button {
            padding: 4px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            white-space: nowrap;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        .status {
            font-size: 12px;
            color: #666;
            white-space: nowrap;
        }

        .status.loading {
            color: #667eea;
        }

        .status.error {
            color: #f44336;
        }

        .status.success {
            color: #4caf50;
        }

        .example-select {
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 11px;
            background: white;
            cursor: pointer;
            white-space: nowrap;
        }

        .log-entry {
            margin-bottom: 8px;
            padding: 4px 0;
        }

        .log-entry.error {
            color: #f48771;
        }

        .log-entry.warn {
            color: #dcdcaa;
        }

        .log-entry.info {
            color: #4ec9b0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ðŸš€ tsfiltor Playground</h1>
            <p>Edit the code below and click "Run" to see the results. The package is loaded from npm via esm.sh CDN.</p>
        </div>
        <div class="content">
            <div class="editor-panel">
                <div class="panel-header">
                    <div class="panel-header-title">Editor</div>
                    <div class="panel-header-controls">
                        <button id="runBtn">â–¶ Run</button>
                        <select id="exampleSelect" class="example-select">
                            <option value="default">Default Example</option>
                            <option value="basic">Basic Usage</option>
                            <option value="advanced">Advanced Filters</option>
                            <option value="chaining">Method Chaining</option>
                        </select>
                        <div class="status" id="status">Ready</div>
                    </div>
                </div>
                <div class="editor-container">
                    <textarea id="codeEditorTextarea" style="display: none;">// Import types and functions - this activates TypeScript support for Array extensions
import 'https://esm.sh/tsfiltor@latest/extensions';
import { enableArrayExtensions } from 'https://esm.sh/tsfiltor@latest/extensions';
import { eq, gt, contains } from 'https://esm.sh/tsfiltor@latest';

// Enable extensions (opt-in)
enableArrayExtensions();

const users = [
    { id: 1, name: 'John Doe', age: 30, email: 'john@example.com', status: 'active', tags: ['vip', 'premium'] },
    { id: 2, name: 'Jane Smith', age: 25, email: 'jane@example.com', status: 'active', tags: ['premium'] },
    { id: 3, name: 'Bob Johnson', age: 18, email: 'bob@test.com', status: 'inactive', tags: [] },
    { id: 4, name: 'Alice Brown', age: 35, email: 'alice@example.com', status: 'pending', tags: ['vip'] },
];

// Now arrays have .where(), .first(), .exists(), .count(), and .findWhere()
const activeUsers = users.where(eq('status', 'active'));
console.log('Active users:', activeUsers);

const john = users.first(eq('name', 'John'));
console.log('John:', john);

const hasVip = users.exists(contains('tags', 'vip'));
console.log('Has VIP users:', hasVip);

const count = users.count(gt('age', 25));
console.log('Users over 25:', count);

// Chain with native array methods
const names = users
  .where(gt('age', 20))
  .map(u => u.name)
  .sort();
console.log('Names of users over 20 (sorted):', names);</textarea>
                </div>
            </div>
            <div class="resizer" id="resizer"></div>
            <div class="output-panel">
                <div class="panel-header">
                    <div class="panel-header-title">Output</div>
                </div>
                <div class="output-container" id="output"></div>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/javascript/javascript.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/typescript/typescript.min.js"></script>
    <script type="module">
        const codeEditorTextarea = document.getElementById('codeEditorTextarea');
        const output = document.getElementById('output');
        const runBtn = document.getElementById('runBtn');
        const status = document.getElementById('status');
        const exampleSelect = document.getElementById('exampleSelect');
        const resizer = document.getElementById('resizer');
        const content = document.querySelector('.content');

        // Declare runCode function first (will be defined later)
        let runCode;
        
        // Initialize CodeMirror
        const codeEditor = CodeMirror.fromTextArea(codeEditorTextarea, {
            mode: 'javascript',
            theme: 'monokai',
            lineNumbers: true,
            indentUnit: 2,
            tabSize: 2,
            indentWithTabs: false,
            lineWrapping: true,
            autofocus: true,
            extraKeys: {
                'Ctrl-Enter': () => runCode(),
                'Cmd-Enter': () => runCode(),
            }
        });

        // Refresh CodeMirror to ensure proper sizing
        setTimeout(() => {
            codeEditor.refresh();
            codeEditor.setSize('100%', '100%');
        }, 100);
        
        // Also refresh on window resize
        window.addEventListener('resize', () => {
            codeEditor.refresh();
        });

        const examples = {
            default: `// Import types and functions - this activates TypeScript support for Array extensions
import 'https://esm.sh/tsfiltor@latest/extensions';
import { enableArrayExtensions } from 'https://esm.sh/tsfiltor@latest/extensions';
import { eq, gt, contains } from 'https://esm.sh/tsfiltor@latest';

// Enable extensions (opt-in)
enableArrayExtensions();

const users = [
    { id: 1, name: 'John Doe', age: 30, email: 'john@example.com', status: 'active', tags: ['vip', 'premium'] },
    { id: 2, name: 'Jane Smith', age: 25, email: 'jane@example.com', status: 'active', tags: ['premium'] },
    { id: 3, name: 'Bob Johnson', age: 18, email: 'bob@test.com', status: 'inactive', tags: [] },
    { id: 4, name: 'Alice Brown', age: 35, email: 'alice@example.com', status: 'pending', tags: ['vip'] },
];

// Now arrays have .where(), .first(), .exists(), .count(), and .findWhere()
const activeUsers = users.where(eq('status', 'active'));
console.log('Active users:', activeUsers);

const john = users.first(eq('name', 'John'));
console.log('John:', john);

const hasVip = users.exists(contains('tags', 'vip'));
console.log('Has VIP users:', hasVip);

const count = users.count(gt('age', 25));
console.log('Users over 25:', count);

// Chain with native array methods
const names = users
  .where(gt('age', 20))
  .map(u => u.name)
  .sort();
console.log('Names of users over 20 (sorted):', names);`,
            basic: `import { filterEntities, eq, gt } from 'https://esm.sh/tsfiltor@latest';

const products = [
    { name: 'Laptop', price: 999, category: 'electronics' },
    { name: 'Phone', price: 699, category: 'electronics' },
    { name: 'Desk', price: 299, category: 'furniture' },
];

// Filter expensive electronics
const expensiveElectronics = filterEntities(products, gt('price', 700));
console.log('Expensive electronics:', expensiveElectronics);

// Filter by category
const electronics = filterEntities(products, eq('category', 'electronics'));
console.log('All electronics:', electronics);`,
            advanced: `import { filterEntities, and, or, contains, startsWith } from 'https://esm.sh/tsfiltor@latest';

const posts = [
    { title: 'Getting Started with TypeScript', tags: ['typescript', 'tutorial'], views: 1000 },
    { title: 'Advanced React Patterns', tags: ['react', 'advanced'], views: 500 },
    { title: 'TypeScript Best Practices', tags: ['typescript', 'best-practices'], views: 2000 },
];

// Complex filter: TypeScript posts with high views OR advanced posts
const filtered = filterEntities(posts, or(
    and(contains('tags', 'typescript'), gt('views', 1500)),
    contains('tags', 'advanced')
));
console.log('Filtered posts:', filtered);`,
            chaining: `import 'https://esm.sh/tsfiltor@latest/extensions';
import { enableArrayExtensions } from 'https://esm.sh/tsfiltor@latest/extensions';
import { eq, gt, contains } from 'https://esm.sh/tsfiltor@latest';

enableArrayExtensions();

const data = [
    { id: 1, name: 'Alice', age: 30, role: 'admin', active: true },
    { id: 2, name: 'Bob', age: 25, role: 'user', active: true },
    { id: 3, name: 'Charlie', age: 35, role: 'admin', active: false },
    { id: 4, name: 'Diana', age: 28, role: 'user', active: true },
];

// Chain multiple operations
const result = data
    .where(gt('age', 25))
    .where(eq('active', true))
    .map(u => u.name.toUpperCase())
    .sort();
console.log('Active users over 25 (uppercase, sorted):', result);`
        };

        // Capture console methods
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;
        const originalInfo = console.info;

        function clearOutput() {
            output.textContent = '';
            output.className = 'output-container';
        }

        function addLogEntry(message, type = 'info') {
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = message;
            output.appendChild(entry);
            output.scrollTop = output.scrollHeight;
        }

        function setupConsoleCapture() {
            console.log = (...args) => {
                originalLog(...args);
                const message = args.map(arg => {
                    if (typeof arg === 'object') {
                        try {
                            return JSON.stringify(arg, null, 2);
                        } catch {
                            return String(arg);
                        }
                    }
                    return String(arg);
                }).join(' ');
                addLogEntry(message, 'info');
            };

            console.error = (...args) => {
                originalError(...args);
                addLogEntry(args.join(' '), 'error');
            };

            console.warn = (...args) => {
                originalWarn(...args);
                addLogEntry(args.join(' '), 'warn');
            };

            console.info = (...args) => {
                originalInfo(...args);
                addLogEntry(args.join(' '), 'info');
            };
        }

        function restoreConsole() {
            console.log = originalLog;
            console.error = originalError;
            console.warn = originalWarn;
            console.info = originalInfo;
        }

        runCode = async function() {
            clearOutput();
            status.textContent = 'Running...';
            status.className = 'status loading';
            runBtn.disabled = true;

            setupConsoleCapture();

            try {
                const code = codeEditor.getValue();
                
                // Create a new module with the user's code
                const blob = new Blob([code], { type: 'application/javascript' });
                const url = URL.createObjectURL(blob);
                
                try {
                    await import(url);
                    status.textContent = 'âœ“ Success';
                    status.className = 'status success';
                    output.className = 'output-container success';
                } catch (error) {
                    throw error;
                } finally {
                    URL.revokeObjectURL(url);
                }
            } catch (error) {
                status.textContent = 'âœ— Error';
                status.className = 'status error';
                output.className = 'output-container error';
                addLogEntry(`Error: ${error.message}`, 'error');
                if (error.stack) {
                    addLogEntry(error.stack, 'error');
                }
            } finally {
                restoreConsole();
                runBtn.disabled = false;
            }
        };

        exampleSelect.addEventListener('change', (e) => {
            const example = examples[e.target.value];
            if (example) {
                codeEditor.setValue(example);
            }
        });

        runBtn.addEventListener('click', runCode);

        // CodeMirror handles keyboard shortcuts via extraKeys config

        // Resizer functionality
        let isResizing = false;
        let startX = 0;
        let startY = 0;
        let startWidth = 0;
        let startHeight = 0;
        let isVertical = false;

        function checkLayout() {
            const isMobile = window.innerWidth <= 968;
            isVertical = isMobile;
            return isMobile;
        }

        resizer.addEventListener('mousedown', (e) => {
            isResizing = true;
            const isMobile = checkLayout();
            if (isMobile) {
                startY = e.clientY;
                const editorPanel = document.querySelector('.editor-panel');
                startHeight = editorPanel.offsetHeight;
                document.body.style.cursor = 'row-resize';
            } else {
                startX = e.clientX;
                const editorPanel = document.querySelector('.editor-panel');
                startWidth = editorPanel.offsetWidth;
                document.body.style.cursor = 'col-resize';
            }
            resizer.classList.add('active');
            document.body.style.userSelect = 'none';
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;
            
            if (isVertical) {
                const deltaY = e.clientY - startY;
                const newHeight = startHeight + deltaY;
                const containerHeight = content.offsetHeight;
                const minHeight = containerHeight * 0.2; // 20% minimum
                const maxHeight = containerHeight * 0.8; // 80% maximum
                
                if (newHeight >= minHeight && newHeight <= maxHeight) {
                    const percentage = (newHeight / containerHeight) * 100;
                    const remaining = 100 - percentage;
                    content.style.gridTemplateRows = `${percentage}% 4px ${remaining}%`;
                }
            } else {
                const deltaX = e.clientX - startX;
                const newWidth = startWidth + deltaX;
                const containerWidth = content.offsetWidth;
                const minWidth = containerWidth * 0.2; // 20% minimum
                const maxWidth = containerWidth * 0.8; // 80% maximum
                
                if (newWidth >= minWidth && newWidth <= maxWidth) {
                    const percentage = (newWidth / containerWidth) * 100;
                    const remaining = 100 - percentage;
                    content.style.gridTemplateColumns = `${percentage}% 4px ${remaining}%`;
                }
            }
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                resizer.classList.remove('active');
                document.body.style.cursor = '';
                document.body.style.userSelect = '';
            }
        });

        // Update layout on window resize
        window.addEventListener('resize', () => {
            if (!isResizing) {
                checkLayout();
                // Reset grid template to default on resize
                if (window.innerWidth <= 968) {
                    content.style.gridTemplateRows = '';
                    content.style.gridTemplateColumns = '';
                } else {
                    content.style.gridTemplateColumns = '';
                    content.style.gridTemplateRows = '';
                }
            }
        });

        // Initial run
        setTimeout(runCode, 500);
    </script>
</body>
</html>
